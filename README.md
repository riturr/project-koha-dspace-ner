The project already includes the training data and the trained models under the `training_data` and `trained_models` directories, respectively. 

If you want to train the models again, follow the steps below.

## Pre-requisites

### 0. Clone the repository

```bash
git clone git@github.com:riturr/project-koha-dspace-ner.git
cd project-koha-dspace-ner
```

### 1. Install the dependencies

```bash
pip install -r requirements.txt
python -m spacy download es_core_news_lg
```

### 2. [Install Tesseract](https://tesseract-ocr.github.io/tessdoc/Installation.html)

## Download the data

### 3. Start the scraper to download the data

TODO: Add instructions

## Generate the training dataset

### 4. Generate the training dataset for each entity

```bash
# Set the paths to the JSONL file generated by the scraper and the directory where the files were downloaded
DATA_PATH="<path to JSONL file generated by scrapy>"
FILES_PATH="<path to files downloaded by scrapy>"

# To generate a training dataset to train a model to recognize titles
python "./src/main/python/registration_asistant_ner/training_data/__init__.py" "$DATA_PATH" "$FILES_PATH"  --entities title --training_files_prefix title --training_files_path "./training_data"

# To generate a training dataset to train a model to recognize names of authors
python "./src/main/python/registration_asistant_ner/training_data/__init__.py" "$DATA_PATH" "$FILES_PATH"  --entities authors --training_files_prefix authors --training_files_path "./training_data"

# To generate a training dataset to train a model to recognize year of publication
python "./src/main/python/registration_asistant_ner/training_data/__init__.py" "$DATA_PATH" "$FILES_PATH"  --entities year --training_files_prefix year --training_files_path "./training_data"

# To generate a training dataset to train a model to recognize names of advisors
python "./src/main/python/registration_asistant_ner/training_data/__init__.py" "$DATA_PATH" "$FILES_PATH"  --entities advisors --training_files_prefix advisors --training_files_path "./training_data"

# To generate a training dataset to train a model to recognize names of faculties
python "./src/main/python/registration_asistant_ner/training_data/__init__.py" "$DATA_PATH" "$FILES_PATH"  --entities faculty --training_files_prefix faculty --training_files_path "./training_data"

# To generate a training dataset to train a model to recognize names of programs (majors)
python "./src/main/python/registration_asistant_ner/training_data/__init__.py" "$DATA_PATH" "$FILES_PATH"  --entities program --training_files_prefix program
```

## Train the NER models

### 5. Train a NER model for each entity

```bash
mkdir trained_models

# Train a model to recognize titles
python -m spacy train train.cfg --custom.suffix "title" --paths.train ./training_data/title_training.spacy --paths.dev ./training_data/title_test.spacy --output "./trained_models/title_ner_model"

# Train a model to recognize names of authors
python -m spacy train train.cfg --custom.suffix "authors" --paths.train ./training_data/authors_training.spacy --paths.dev ./training_data/authors_test.spacy --output "./trained_models/authors_ner_model"

# Train a model to recognize year of publication
python -m spacy train train.cfg --custom.suffix "year" --paths.train ./training_data/year_training.spacy --paths.dev ./training_data/year_test.spacy --output "./trained_models/year_ner_model"

# Train a model to recognize names of advisors
python -m spacy train train.cfg --custom.suffix "advisors" --paths.train ./training_data/advisors_training.spacy --paths.dev ./training_data/advisors_test.spacy --output "./trained_models/advisors_ner_model"

# Train a model to recognize names of faculties
python -m spacy train train.cfg --custom.suffix "faculty" --paths.train ./training_data/faculty_training.spacy --paths.dev ./training_data/faculty_test.spacy --output "./trained_models/faculty_ner_model"

# Train a model to recognize names of programs (majors)
python -m spacy train train.cfg --custom.suffix "program" --paths.train ./training_data/program_training.spacy --paths.dev ./training_data/program_test.spacy --output "./trained_models/program_ner_model"
```
